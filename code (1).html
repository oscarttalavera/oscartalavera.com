<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Lila's Treat Catch</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            touch-action: none; 
            overflow: hidden; 
        }

        #game-container {
            width: 95vw;
            max-width: 400px;
            height: 80vh;
            max-height: 600px;
            background-color: #87CEEB; 
            border: 2px solid #333;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        #lila {
            width: 60px; 
            height: 80px; 
            background-image: url('data:image/png;base64,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');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center bottom;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            transition: left 0.1s linear; 
        }

        .treat {
            width: 30px;
            height: 30px;
            font-size: 24px; 
            text-align: center;
            line-height: 30px;
            position: absolute;
            top: -30px; 
        }

        #score-board {
            margin-top: 10px;
            font-size: 1.5em;
            color: #333;
        }
        
        #start-screen, #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            z-index: 10;
        }

        #start-screen h2, #game-over-screen h2 {
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="lila"></div>
        <div id="start-screen">
            <h2>Lila's Treat Catch</h2>
            <p>¡Ayuda a Lila a atrapar los premios!</p>
            <p>Desliza para mover a Lila.</p>
            <button id="start-button">Empezar Juego</button>
        </div>
        <div id="game-over-screen" style="display: none;">
            <h2>¡Juego Terminado!</h2>
            <p id="final-score"></p>
            <button id="restart-button">Jugar de Nuevo</button>
        </div>
    </div>
    <div id="score-board">Puntuación: <span id="score">0</span> | Tiempo: <span id="time">30</span></div>

    <script>
        const gameContainer = document.getElementById('game-container');
        const lila = document.getElementById('lila');
        const scoreDisplay = document.getElementById('score');
        const timeDisplay = document.getElementById('time');
        
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over-screen');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const finalScoreDisplay = document.getElementById('final-score');

        let score = 0;
        let timeLeft = 30;
        let gameInterval;
        let treatInterval;
        let timerInterval;
        let treats = [];

        let gameWidth = gameContainer.offsetWidth; // Se inicializan aquí
        let gameHeight = gameContainer.offsetHeight;
        let lilaWidth = lila.offsetWidth;


        function updateGameDimensions() {
            // Actualiza las dimensiones si es necesario (ej. en un resize)
            // Por ahora, para el inicio del juego, las iniciales deberían bastar
            // pero es buena práctica tener una función así si el layout puede cambiar.
            gameWidth = gameContainer.offsetWidth;
            gameHeight = gameContainer.offsetHeight;
            lilaWidth = lila.offsetWidth;
        }

        function initGame() {
            console.log("initGame: Iniciando...");
            updateGameDimensions(); // Asegura que las dimensiones son actuales

            score = 0;
            timeLeft = 30;
            
            console.log("initGame: Limpiando treats existentes. Cantidad actual:", treats.length);
            treats.forEach(treat => {
                // Solo intenta remover si el elemento existe y está en el DOM
                if (treat.element && treat.element.parentNode) {
                    treat.element.remove();
                }
            });
            treats = []; // Resetea el array de treats
            
            scoreDisplay.textContent = score;
            timeDisplay.textContent = timeLeft;
            
            // Posiciona a Lila
            console.log("initGame: Posicionando a Lila. gameWidth:", gameWidth, "lilaWidth:", lilaWidth);
            if (gameWidth > 0 && lilaWidth > 0) { // Chequeo básico
                 lila.style.left = (gameWidth / 2 - lilaWidth / 2) + 'px';
            } else {
                console.warn("initGame: gameWidth o lilaWidth son 0, Lila podría no posicionarse bien.");
                lila.style.left = '50%'; // Fallback si las dimensiones no están listas
            }
            
            gameOverScreen.style.display = 'none';
            console.log("initGame: Ocultando pantalla de inicio.");
            startScreen.style.display = 'none'; // ESTA ES LA LÍNEA CLAVE
            gameContainer.style.cursor = 'none'; 
            console.log("initGame: Finalizado. startScreen display:", startScreen.style.display);
        }

        function startGame() {
            console.log("startGame: Empezando el juego...");
            // Limpiar intervalos anteriores por si acaso (importante si se llama startGame repetidamente)
            if (gameInterval) clearInterval(gameInterval);
            if (treatInterval) clearInterval(treatInterval);
            if (timerInterval) clearInterval(timerInterval);

            initGame();

            console.log("startGame: Iniciando intervalos del juego.");
            gameInterval = setInterval(gameLoop, 20); 
            treatInterval = setInterval(createTreat, 1200); 
            timerInterval = setInterval(updateTimer, 1000);
            console.log("startGame: Intervalos iniciados.");
        }

        function gameOver() {
            console.log("gameOver: Juego terminado.");
            clearInterval(gameInterval);
            clearInterval(treatInterval);
            clearInterval(timerInterval);
            
            finalScoreDisplay.textContent = 'Tu puntuación: ' + score;
            gameOverScreen.style.display = 'flex';
            gameContainer.style.cursor = 'default';
        }

        function updateTimer() {
            timeLeft--;
            timeDisplay.textContent = timeLeft;
            if (timeLeft <= 0) {
                gameOver();
            }
        }

        function createTreat() {
            if (gameWidth <= 0) { // Chequeo por si gameWidth no se calculó bien
                console.warn("createTreat: gameWidth es 0 o inválido. Usando un valor por defecto.");
                // gameWidth = gameContainer.offsetWidth; // Intenta recalcular
                // if (gameWidth <= 0) gameWidth = 300; // Fallback extremo
            }

            const treatElement = document.createElement('div');
            treatElement.classList.add('treat');
            treatElement.textContent = '🦴'; 
            treatElement.style.left = Math.random() * (gameWidth - 30) + 'px'; // 30 es el ancho del treat
            treatElement.style.top = '-30px';
            gameContainer.appendChild(treatElement);
            treats.push({ element: treatElement, x: parseFloat(treatElement.style.left), y: -30 });
        }

        function gameLoop() {
            moveTreats();
            checkCollisions();
        }

        function moveTreats() {
            treats.forEach((treat, index) => {
                treat.y += 5; 
                treat.element.style.top = treat.y + 'px';

                if (treat.y > gameHeight) {
                    treat.element.remove();
                    treats.splice(index, 1);
                }
            });
        }

        function checkCollisions() {
            const lilaRect = lila.getBoundingClientRect();
            treats.forEach((treat, index) => {
                const treatRect = treat.element.getBoundingClientRect();

                if (
                    lilaRect.left < treatRect.right &&
                    lilaRect.right > treatRect.left &&
                    lilaRect.top < treatRect.bottom &&
                    lilaRect.bottom > treatRect.top
                ) {
                    treat.element.remove();
                    treats.splice(index, 1);
                    score++;
                    scoreDisplay.textContent = score;
                }
            });
        }

        // Controles táctiles
        let touchStartX = 0;
        let lilaStartLeft = 0;

        gameContainer.addEventListener('touchstart', (e) => {
            if (gameOverScreen.style.display === 'flex' || startScreen.style.display === 'flex') return;
            touchStartX = e.touches[0].clientX;
            lilaStartLeft = lila.offsetLeft;
            e.preventDefault(); 
        });

        gameContainer.addEventListener('touchmove', (e) => {
            if (gameOverScreen.style.display === 'flex' || startScreen.style.display === 'flex') return;
            let touchMoveX = e.touches[0].clientX;
            let deltaX = touchMoveX - touchStartX;
            let newLilaLeft = lilaStartLeft + deltaX;

            if (newLilaLeft < 0) newLilaLeft = 0;
            if (newLilaLeft > gameWidth - lilaWidth) newLilaLeft = gameWidth - lilaWidth;
            
            lila.style.left = newLilaLeft + 'px';
            e.preventDefault(); 
        });
        
        gameContainer.addEventListener('touchend', (e) => {
            if (gameOverScreen.style.display === 'flex' || startScreen.style.display === 'flex') return;
            e.preventDefault();
        });


        // Controles de teclado (para escritorio)
        document.addEventListener('keydown', (e) => {
            if (gameOverScreen.style.display === 'flex' || startScreen.style.display === 'flex') return;
            
            let lilaLeft = lila.offsetLeft;
            if (e.key === 'ArrowLeft') {
                lilaLeft -= 25;
            } else if (e.key === 'ArrowRight') {
                lilaLeft += 25;
            }

            if (lilaLeft < 0) lilaLeft = 0;
            if (lilaLeft > gameWidth - lilaWidth) lilaLeft = gameWidth - lilaWidth;
            lila.style.left = lilaLeft + 'px';
        });

        startButton.addEventListener('click', () => {
            console.log("Botón 'Empezar Juego' clickeado!");
            startGame();
        });
        restartButton.addEventListener('click', () => {
            console.log("Botón 'Jugar de Nuevo' clickeado!");
            startGame();
        });

        // Ajuste básico de dimensiones al cargar (las globales gameWidth, etc. ya se calculan)
        // Un listener de resize más completo sería necesario para juegos más complejos
        window.addEventListener('resize', () => {
            // updateGameDimensions(); // Podrías llamar esto
            // Considera pausar el juego o mostrar un mensaje para reiniciar
            // si el cambio de tamaño ocurre durante el juego activo.
            console.log("Ventana redimensionada. Las dimensiones del juego podrían necesitar actualizarse al reiniciar.");
        });

        console.log("Script del juego cargado. Esperando inicio...");
    </script>
</body>
</html>