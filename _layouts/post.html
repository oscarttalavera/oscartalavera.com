---
layout: default
---

<article class="post">
  <header class="post-header">
    <h1 class="post-title">{{ page.title }}</h1>
    <div class="post-meta">
      <span class="post-date">{{ page.date | date: "%d %b %Y" }}</span>
      {% if page.tags.size > 0 %}
      <span class="post-tags">
        {% for tag in page.tags %}
        <span class="tag">{{ tag }}</span>
        {% endfor %}
      </span>
      {% endif %}
    </div>
  </header>

  {% if page.audio %}
  <div class="audio-container">
    <div class="audio-player-wrapper">
      <div class="audio-cover">
        {% if page.image %}
        <img src="{{ page.image }}" alt="{{ page.title }} cover">
        {% else %}
        <div class="audio-default-cover">
          <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18V5l12-2v13"></path>
            <circle cx="6" cy="18" r="3"></circle>
            <circle cx="18" cy="16" r="3"></circle>
          </svg>
        </div>
        {% endif %}
      </div>
      
      <div class="audio-info">
        <h3 class="audio-title">{{ page.audio.title | default: "Escucha este texto" }}</h3>
        {% if page.audio.narrator %}
        <p class="audio-narrator">Narrado por {{ page.audio.narrator }}</p>
        {% endif %}
        
        <div class="audio-controls">
          <audio id="audio-{{ page.id | slugify }}" class="audio-element">
            <source src="{{ page.audio.file }}" type="audio/mpeg">
            Tu navegador no soporta el elemento de audio.
          </audio>
          
          <button class="play-pause-btn" aria-label="Play/Pause">
            <svg class="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
            <svg class="pause-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </button>
          
          <div class="audio-progress">
            <div class="progress-bar">
              <div class="progress-filled"></div>
            </div>
            <div class="time-display">
              <span class="current-time">0:00</span>
              <span class="duration">{{ page.audio.duration | default: "0:00" }}</span>
            </div>
          </div>
          
          <div class="audio-extras">
            <button class="volume-btn" aria-label="Volume">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
              </svg>
            </button>
            
            {% if page.audio.downloadable %}
            <a href="{{ page.audio.file }}" class="download-btn" download aria-label="Descargar audio">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    
    {% if page.audio.description %}
    <p class="audio-description">{{ page.audio.description }}</p>
    {% endif %}
    
    {% if page.audio.transcript %}
    <details class="audio-transcript">
      <summary>Ver transcripción</summary>
      <div class="transcript-content">
        <!-- Aquí iría la transcripción -->
      </div>
    </details>
    {% endif %}
  </div>
  {% endif %}
  
  {% if page.image %}
  <div class="post-featured-image">
    <img src="{{ page.image }}" alt="{{ page.title }}">
  </div>
  {% endif %}
  
  <div class="post-content">
    {{ content }}
  </div>
  
  {% if page.author %}
  <div class="author-section">
    <div class="author-avatar">
      <img src="/assets/img/avatar.jpg" alt="{{ page.author }}">
    </div>
    <div class="author-info">
      <h4 class="author-name">{{ page.author }}</h4>
      <p class="author-bio">Ingeniero, artemarcialista, home barista, dj y escritor con la ayuda de IA.</p>
    </div>
  </div>
  {% endif %}
  
  <footer class="post-footer">
    <a href="/textos" class="back-link">← Volver a todos los textos</a>
  </footer>
</article>

<section class="related-posts">
  <h3>Textos relacionados</h3>
  <div class="related-posts-grid">
    {% assign maxRelated = 3 %}
    {% assign minCommonTags = 1 %}
    {% assign maxRelatedCounter = 0 %}
    
    {% for post in site.posts %}
      {% assign sameTagCount = 0 %}
      {% for tag in post.tags %}
        {% if post.url != page.url %}
          {% if page.tags contains tag %}
            {% assign sameTagCount = sameTagCount | plus: 1 %}
          {% endif %}
        {% endif %}
      {% endfor %}
      
      {% if sameTagCount >= minCommonTags and maxRelatedCounter < maxRelated %}
        <div class="post-item">
          <a href="{{ post.url }}">
            <div class="post-thumb" style="background-image: url('{{ post.image }}');"></div>
            <div class="post-content">
              <h2>{{ post.title }}</h2>
              <p class="date">{{ post.date | date: "%d %b %Y" }}</p>
            </div>
          </a>
        </div>
        {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
      {% endif %}
    {% endfor %}
    
    {% if maxRelatedCounter == 0 %}
      {% for post in site.posts limit:3 %}
        {% if post.url != page.url %}
          <div class="post-item">
            <a href="{{ post.url }}">
              <div class="post-thumb" style="background-image: url('{{ post.image }}');"></div>
              <div class="post-content">
                <h2>{{ post.title }}</h2>
                <p class="date">{{ post.date | date: "%d %b %Y" }}</p>
              </div>
            </a>
          </div>
        {% endif %}
      {% endfor %}
    {% endif %}
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const audioContainers = document.querySelectorAll('.audio-container');
  
  audioContainers.forEach(container => {
    const audio = container.querySelector('audio');
    const playPauseBtn = container.querySelector('.play-pause-btn');
    const playIcon = container.querySelector('.play-icon');
    const pauseIcon = container.querySelector('.pause-icon');
    const progressBar = container.querySelector('.progress-bar');
    const progressFilled = container.querySelector('.progress-filled');
    const currentTimeDisplay = container.querySelector('.current-time');
    const durationDisplay = container.querySelector('.duration');
    
    // Play/Pause toggle
    playPauseBtn.addEventListener('click', () => {
      if (audio.paused) {
        audio.play();
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
      } else {
        audio.pause();
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
      }
    });
    
    // Update progress bar
    audio.addEventListener('timeupdate', () => {
      const progress = (audio.currentTime / audio.duration) * 100;
      progressFilled.style.width = `${progress}%`;
      currentTimeDisplay.textContent = formatTime(audio.currentTime);
    });
    
    // Seek functionality
    progressBar.addEventListener('click', (e) => {
      const rect = progressBar.getBoundingClientRect();
      const pos = (e.clientX - rect.left) / rect.width;
      audio.currentTime = pos * audio.duration;
    });
    
    // Load metadata
    audio.addEventListener('loadedmetadata', () => {
      durationDisplay.textContent = formatTime(audio.duration);
    });
    
    // Reset on end
    audio.addEventListener('ended', () => {
      playIcon.style.display = 'block';
      pauseIcon.style.display = 'none';
      progressFilled.style.width = '0%';
    });
  });
  
  // Format time helper
  function formatTime(seconds) {
    if (isNaN(seconds)) return '0:00';
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = Math.floor(seconds % 60);
    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
  }
});
</script>
